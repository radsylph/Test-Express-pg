import {Injectable} from '@angular/core';
import {Http, Response, RequestOptions, URLSearchParams, Headers} from '@angular/http';
import {ConfigService} from './config.service';
import {Observable} from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class UserService {

  constructor(private _configService: ConfigService, private http: Http) { }

  public obtenerUsuario(_token: string, onSuccess: any, onError: any): Promise<any> {
    const headers = new Headers({ 'Content-Type': 'application/json' });
    const body = {token: _token, url: ''};
    const bodyString = JSON.stringify(body);

    const options = new RequestOptions({ headers: headers });

    return this.http.post(this._configService.hostSeguridad + 'Token_obtenerUsuario',
      bodyString, options)
      .toPromise()
      .then(response => this._configService.manejarRespuesta(response, onSuccess, onError))
      .catch(response => this._configService.manejarError(response));
  }

  public obtenerToken(_body: any, onSuccess: any, onError: any): Promise<any> {
    const headers = new Headers({ 'Content-Type': 'application/json' });
    const options = new RequestOptions({ headers: headers });
    const bodyString = JSON.stringify(_body);

    return this.http.post(this._configService.hostSeguridad + 'Usuario_Login',
      bodyString, options)
      .toPromise()
      .then(response => this._configService.manejarRespuesta(response, onSuccess, onError))
      .catch(response => this._configService.manejarError(response));
  }

  public getMenuHabilitados(onSuccess: any, onError: any): Promise<any>{
    let headers = new Headers({ 'Content-Type': 'application/json' });
    let options = new RequestOptions({ headers: headers });

    return this.http.get(this._configService.hostSeguridad + 'menuHabilitados', options)
      .toPromise()
      .then(response => this._configService.manejarRespuesta(response, onSuccess, onError))
      .catch(response =>this._configService.manejarError(response));
  }
}
